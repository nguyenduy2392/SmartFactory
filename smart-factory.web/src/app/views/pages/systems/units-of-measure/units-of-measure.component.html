<div class="surface-ground page">
  <!-- Header -->
  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">Quản lý Đơn vị tính</h2>
    <p-button 
      label="Thêm đơn vị" 
      icon="pi pi-plus" 
      (onClick)="openCreateDialog()">
    </p-button>
  </div>

  <!-- Table -->
  <p-table 
    [value]="units" 
    [loading]="loading"
    [paginator]="true" 
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Hiển thị {first} đến {last} trong tổng số {totalRecords} bản ghi"
    styleClass="p-datatable-gridlines">
    
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 15%">Mã đơn vị</th>
        <th style="width: 25%">Tên đơn vị</th>
        <th style="width: 30%">Mô tả</th>
        <th style="width: 10%">Thứ tự</th>
        <th style="width: 10%">Trạng thái</th>
        <th style="width: 10%">Thao tác</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-unit>
      <tr>
        <td>{{ unit.code }}</td>
        <td>{{ unit.name }}</td>
        <td>{{ unit.description || '-' }}</td>
        <td>{{ unit.displayOrder }}</td>
        <td>
          <p-tag 
            [value]="unit.isActive ? 'Hoạt động' : 'Ngừng'" 
            [severity]="getStatusSeverity(unit.isActive)">
          </p-tag>
        </td>
        <td>
          <p-button 
            icon="pi pi-pencil" 
            [rounded]="true"
            [text]="true"
            severity="info"
            (onClick)="openEditDialog(unit)"
            pTooltip="Sửa">
          </p-button>
          <p-button 
            icon="pi pi-trash" 
            [rounded]="true"
            [text]="true"
            severity="danger"
            (onClick)="deleteUnit(unit)"
            pTooltip="Xóa">
          </p-button>
        </td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center">Không có dữ liệu</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Dialog Form -->
<p-dialog 
  [(visible)]="showDialog" 
  [header]="isEdit ? 'Sửa đơn vị tính' : 'Thêm đơn vị tính mới'"
  [modal]="true" 
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false">
  
  <div class="grid p-fluid">
    <div class="col-6">
      <label for="code" class="block mb-2">Mã đơn vị <span class="text-red-500">*</span></label>
      <input 
        pInputText 
        id="code" 
        [(ngModel)]="unitForm.code" 
        name="code"
        placeholder="Ví dụ: kg, l, pcs"
        class="w-full"
        required />
    </div>

    <div class="col-6">
      <label for="name" class="block mb-2">Tên đơn vị <span class="text-red-500">*</span></label>
      <input 
        pInputText 
        id="name" 
        [(ngModel)]="unitForm.name" 
        name="name"
        placeholder="Ví dụ: Kilogram, Lít, Cái"
        class="w-full"
        required />
    </div>

    <div class="col-12">
      <label for="description" class="block mb-2">Mô tả</label>
      <textarea 
        pInputTextarea 
        id="description" 
        [(ngModel)]="unitForm.description" 
        name="description"
        rows="3"
        placeholder="Mô tả về đơn vị tính"
        class="w-full">
      </textarea>
    </div>

    <div class="col-6">
      <label for="displayOrder" class="block mb-2">Thứ tự hiển thị</label>
      <p-inputNumber 
        id="displayOrder"
        [(ngModel)]="unitForm.displayOrder" 
        name="displayOrder"
        [min]="0"
        [useGrouping]="false"
        styleClass="w-full">
      </p-inputNumber>
    </div>

    <div class="col-6 flex align-items-center">
      <p-checkbox 
        [(ngModel)]="unitForm.isActive" 
        [binary]="true" 
        inputId="isActive"
        name="isActive">
      </p-checkbox>
      <label for="isActive" class="ml-2">Hoạt động</label>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button 
      label="Hủy" 
      icon="pi pi-times" 
      severity="secondary"
      [text]="true"
      (onClick)="showDialog = false">
    </p-button>
    <p-button 
      label="Lưu" 
      icon="pi pi-check" 
      (onClick)="saveUnit()">
    </p-button>
  </ng-template>
</p-dialog>
