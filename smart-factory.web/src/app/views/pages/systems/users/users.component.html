<div class="surface-ground page">
  <!-- Thanh công cụ -->
  <div class="flex justify-content-end mb-3">
    <p-button (onClick)="AddUser()" icon="pi pi-user-plus" label="Thêm mới người dùng" />
  </div>
  
  <div class="card shadow-2 bg-white border-round">
    <p-accordion [activeIndex]="0" expandIcon="pi pi-search-plus" collapseIcon="pi pi-search-minus">
      <p-accordionTab header="Lọc dữ liệu">
        <div class="grid">
          <div class="col-4">
            <label class="block text-900 font-medium mb-3">Từ khóa tìm kiếm</label>
            <div class="flex">
              <input [(ngModel)]="filter.keyword" type="text" pInputText placeholder="Tìm theo tên, email, số điện thoại"
                class="w-full" />
            </div>
          </div>
          <div class="col-3">
            <label class="block text-900 font-medium mb-3">Trạng thái</label>
            <div class="flex">
              <p-dropdown [(ngModel)]="filter.isActive" class="w-100" [options]="statuses" [showClear]="true"
                placeholder="Tất cả trạng thái" [style]="{ width: '100%' }" optionLabel="name" optionValue="value" />
            </div>
          </div>
          <div class="col-3 flex">
            <div class="mr-3">
              <label class="block text-900 font-medium mb-3">&nbsp;</label>
              <p-button (onClick)="GetAllUsers()" icon="pi pi-search" label="Tìm kiếm" [outlined]="true"
                severity="primary">
              </p-button>
            </div>
          </div>
        </div>
      </p-accordionTab>
    </p-accordion>

    <p-table #dt [value]="users" [lazy]="false" sortMode="single" [scrollable]="true" scrollWidth="60rem"
      scrollDirection="horizontal" [paginator]="true" [rows]="10" [loading]="isLoading"
      styleClass="p-datatable-gridlines p-datatable-sm" [tableStyle]="{ 'min-width': '60rem' }" [rowHover]="true"
      dataKey="id" selectionMode="single" loadingIcon="pi pi-cog pi-spin text-white">
      <ng-template pTemplate="header">
        <tr class="px-2">
          <th style="width: 4rem" class="text-center">#</th>
          <th pSortableColumn="fullName" class="text-center" style="min-width: 12rem">
            <span>Họ tên</span>
            <p-sortIcon field="fullName"></p-sortIcon>
          </th>
          <th pSortableColumn="email" class="text-center" style="min-width: 12rem">
            <span>Email</span>
            <p-sortIcon field="email"></p-sortIcon>
          </th>
          <th class="text-center" style="min-width: 8rem">
            <span>Số điện thoại</span>
          </th>
          <th pSortableColumn="isActive" class="text-center" style="min-width: 8rem">
            <span>Trạng thái</span>
            <p-sortIcon field="isActive"></p-sortIcon>
          </th>
          <th pSortableColumn="createdAt" class="text-center" style="min-width: 10rem">
            <span>Ngày tạo</span>
            <p-sortIcon field="createdAt"></p-sortIcon>
          </th>
          <th class="text-center" style="min-width: 6rem">
            <span>Thao tác</span>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
        <tr>
          <td class="text-center">
            {{ rowIndex + 1 }}
          </td>

          <td>
            <a href="javascript:;" (click)="EditUser(item)" class="text-primary font-medium">
              {{ item.fullName }}
            </a>
          </td>

          <td>
            {{ item.email }}
          </td>

          <td class="text-center">
            {{ item.phoneNumber || '-' }}
          </td>

          <td class="text-center">
            <p-tag *ngIf="item.isActive" severity="success" value="Hoạt động"></p-tag>
            <p-tag *ngIf="!item.isActive" severity="danger" value="Đã khóa"></p-tag>
          </td>

          <td class="text-center">
            {{ item.createdAt | date:'dd/MM/yyyy HH:mm' }}
          </td>

          <td class="text-center">
            <p-button (click)="EditUser(item)" icon="pi pi-pencil" severity="warning" [text]="true" 
              pTooltip="Chỉnh sửa" tooltipPosition="top" />
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center py-4">
            <i class="pi pi-inbox text-4xl text-300 mb-3"></i>
            <p class="text-500">Không có dữ liệu người dùng</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
    
    <div class="flex align-items-center justify-content-between sticky bottom-0 bg-white w-full z-1 py-2">
      <div>
        <span class="text-500">Tổng số: <strong>{{ total }}</strong> người dùng</span>
      </div>
      <div>
        <p-button (onClick)="Refresh()" icon="pi pi-refresh" [text]="true" pTooltip="Làm mới" tooltipPosition="top" />
      </div>
    </div>
  </div>
</div>
